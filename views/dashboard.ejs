<!DOCTYPE html>
<html>

<head>
    <title>US Map</title>
    <link rel="stylesheet" href="/stylesheets/map.css">
    <link rel="stylesheet" href="/stylesheets/dashboard.css">
    <script src="/javascripts/raphael.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
    <script src="/javascripts/color.jquery.js"></script>
    <script src="/javascripts/jquery.usmap.js"></script>
    <script src="/javascripts/domModify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
    <link href="/stylesheets/nv.d3.min.css" >
    <script src="/stylesheets/nv.d3.min.js"></script>

    <script>
        var BarChart ;
        $(document).ready(function() {
            $('#map').usmap({
                'click' : function(event, selected) {
                    $('#alert')
                        .text('Selected state: '+selected.name)
                        .stop()
                        .css('backgroundColor', '#ff0')
                        .animate({backgroundColor: '#ddd'}, 1000);


                    const Url = "http://localhost:3000/dashboard/state?selectedState="+selected.name;
                    $.ajax({url : Url, success: function (res) {
                        console.log(res.data);
                        addBargraph(res.data);
                        addLineGraph(res.yearData);
                    }});
                }
            });
        });

        addBargraph([]);
        addLineGraph([]);

        function addBargraph(BarChart){
            nv.addGraph(function() {

                var chart = nv.models.discreteBarChart()
                    .x(function(d) { return d.label })
                    .y(function(d) { return d.value })
                    .staggerLabels(true)
                    .showValues(true)
                    .duration(250)
                    .height(300);
                ;
                d3.select('#chart1 svg')
                    .datum(BarChart)
                    .call(chart);

                d3.select('#chart1 svg')
                    .append("text")
                    .attr("x", 150)
                    .attr("y", 310)
                    .attr("text-anchor", "middle")
                    .text("Comparision of evictions")
                    .attr("class","Title")


                nv.utils.windowResize(chart.update);
                return chart;
            });
        }

        function addLineGraph(lineChart) {
            nv.addGraph(function() {
                var chart = nv.models.lineChart()
                    .useInteractiveGuideline(true)
                    .height(300)
                    .showYAxis(true)
                    .showXAxis(true)
                ;

                chart.xAxis
                    .axisLabel('Year');

                chart.yAxis
                    .axisLabel('Number of evictions');

                d3.select('#chart2 svg')
                    .datum(lineChart)
                    .transition().duration(500)
                    .call(chart)
                ;

                d3.select('#chart2 svg')
                    .append("text")
                    .attr("x", 250)
                    .attr("y", 310)
                    .attr("text-anchor", "middle")
                    .text("Comparision of evictions from 2000 to 2016")
                    .attr("class","Title");

                d3.select('#chart2 .nv-y').attr('class', 'y-border');

                nv.utils.windowResize(chart.update);

                return chart;
            });
        }



    </script>

</head>

<body onload=headerModification()>
<% include header %>
<div class="title">Please select any state to view data</div>
<div id="alert">Selected State: </div>
<div id="map" style="width: 500px; height: 300px"></div>
<div id="chart1">
    <svg></svg>
</div>

<div id="chart2">
    <svg></svg>
</div>

<% include footer%>
</body>

</html>