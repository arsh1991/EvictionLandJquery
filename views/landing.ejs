<html>
<meta charset="utf-8">

<head>
    <link href="/stylesheets/jquery-ui.css" rel="stylesheet">
    <link href="/stylesheets/admin.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="/javascripts/domModify.js"></script>
    <script src="/external/jquery/jquery.js"></script>
    <script src="/javascripts/jquery-ui.js"></script>
    <script>
        function deleteuser(event) {
            var email = event.currentTarget.closest(".userRecord").querySelector(".email").innerText;
            console.log(email);
            const Url ="http://localhost:3000/admin/deleteUser?user="+email;
            $.ajax(
                {
                    type: "POST",
                    url : Url,
                    data : {user : email},
                    success: function (res) {
                        $('#searchResult').html("Deleted User");
                    }
                });
        }
    </script>
</head>

<body onload=headerModification()>
<div class="header"></div>
<div>
    <% include header %>

    <div class="forms">
        <div class="leftside" id="csvfileUpload">
            <form method="post" enctype="multipart/form-data" action="/admin/add">
                <h4 for="csvfile">CSV File Upload</h4>
                <input type="file" name="csvfile" id="csvfile"><br>
                <button type="submit">Submit</button>
                <label><%= message %></label>
                <label><%= error %></label>
            </form>
        </div>
        <div class="rightside">
            <form class="UserForm" method="get" action="/admin/searchuser">
                <div class="heading">Please search a user</div>
                <div class="ui-widget">
                    <label for="tags">Search: </label>
                    <input id="tags" name="user">
                    <button id="searchUser" class="okButton" type="submit">Submit</button>
                    <label><%= errorMsg %></label>
                </div>
            </form>
            <script>
                var userdata;
                userdata = <%- JSON.stringify(userdata) %>;
            </script>
            <% if(userdata) { %>
            <% for (var i = 0; i < userdata.length; i++) {
                var username =    userdata[i].email;
            %>
            <div id="searchResult">
                <div class="userRecord">
                    <span class="userName">
                        <%= userdata[i].userName %>
                    </span>
                    <span class="email" name="email">
                        <%= userdata[i].email %>
                    </span>
                    <span class="phone">
                        <%= userdata[i].phone %>
                </span>
                    <span>
                    <button class="delete" id="Delete" onclick="deleteuser(event)">Delete</button>
                </span>
                </div>
            </div>

        </div>
        <% } %>
        <% } %>
    </div>
</div>


</div>
<% include footer %>
</body>