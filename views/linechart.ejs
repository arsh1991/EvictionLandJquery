<!DOCTYPE html>
<meta charset="utf-8">

<html>
<head>
    <title>US Map</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="/javascripts/linechart.js" ></script>
    <link rel="stylesheet" href="/stylesheets/map.css">
    <link rel="stylesheet" href="/stylesheets/dashboard.css">
    <script src="/javascripts/raphael.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
    <script src="/javascripts/color.jquery.js"></script>
    <script src="/javascripts/jquery.usmap.js"></script>
    <script src="/javascripts/domModify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
    <link href="/stylesheets/nv.d3.min.css" >
    <script src="/stylesheets/nv.d3.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#map').usmap({
                'click' : function(event, selected) {
                    $("#linechart").children().children().remove();

                    const Url = "http://localhost:3000/linechart/state?selectedState="+selected.name;
                    $.ajax({url : Url, success: function (res) {
                            addLineGraph(res);
                        }});
                }
            });
        });


        // addLineGraph([]);

        function addLineGraph(lineChart) {
            nv.addGraph(function() {
                var chart = nv.models.lineChart()
                    .margin({ left:100})
                    .useInteractiveGuideline(true)
                    .showLegend(true)
                    .height(300)
                    .showYAxis(true)
                    .showXAxis(true);

                chart.y(function (d) { return d.y; });
                chart.xAxis
                    .axisLabel('Year');

                chart.yAxis
                    .axisLabel('Eviction Rate');

                d3.select('#linechart svg')
                    .datum(lineChart)
                    .transition().duration(500).call(chart)
                ;

                d3.select('#linechart svg')
                    .append("text")
                    .attr("x", 250)
                    .attr("y", 310)
                    .attr("text-anchor", "middle")
                    .text("Comparision of eviction rates from 2000 to 2016")
                    .attr("class","Title");

                d3.select('#linechart .nv-y').attr('class', 'y-border');

                nv.utils.windowResize(function() {
                    chart.update
                });

                return chart;
            });
        }
    </script>

</head>
<body onload=headerModification()>
<div id="map" style="width: 500px; height: 300px"></div>
<div id="linechart">
    <svg></svg>
</div>\
</body>
</html>